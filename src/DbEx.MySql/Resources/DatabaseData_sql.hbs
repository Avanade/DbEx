{{! Copyright (c) Avanade. Licensed under the MIT License. See https://github.com/Avanade/DbEx }}
{{#if IsMerge}}
  {{#each Rows}}
INSERT INTO `{{Table.Name}}` ({{#each Columns}}`{{Name}}`{{#unless @last}}, {{/unless}}{{/each}}) VALUES ({{#each Columns}}{{#if UseForeignKeyQueryForId}}(SELECT `{{DbColumn.ForeignColumn}}` FROM `{{DbColumn.ForeignTable}}` WHERE `{{DbColumn.ForeignRefDataCodeColumn}}` = {{{SqlValue}}} LIMIT 1){{else}}{{{SqlValue}}}{{/if}}{{#unless @last}}, {{/unless}}{{/each}}) ON DUPLICATE KEY UPDATE {{#each Table.MergeUpdateColumns}}`{{Name}}` = VALUES(`{{Name}}`){{#unless @last}}, {{/unless}}{{/each}};
  {{/each}}
SELECT {{Rows.Count}}; -- Total rows upserted
{{else}}
  {{#each Rows}}
INSERT INTO `{{Table.Name}}` ({{#each Columns}}`{{Name}}`{{#unless @last}}, {{/unless}}{{/each}}) VALUES ({{#each Columns}}{{#if UseForeignKeyQueryForId}}(SELECT `{{DbColumn.ForeignColumn}}` FROM `{{DbColumn.ForeignTable}}` WHERE `{{DbColumn.ForeignRefDataCodeColumn}}` = {{{SqlValue}}} LIMIT 1){{else}}{{{SqlValue}}}{{/if}}{{#unless @last}}, {{/unless}}{{/each}});
  {{/each}}
SELECT {{Rows.Count}}; -- Total rows inserted
{{/if}}